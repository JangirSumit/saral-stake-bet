<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="config-styles.css" />
    <script src="config-management.js" defer></script>

  </head>
  <body>
    <div id="refreshNote" class="refresh-note">
      âš ï¸ Refresh the main page if status is not in sync with Bet Button
    </div>
    <div class="status-bet-container">
      <div id="buttonStatus" class="button-status disconnected">
        <span class="status-dot red" title="Not Connected"></span>
        <span class="status-text">Ready</span>
      </div>
      <div id="currentBetAmount" class="current-bet-amount">Next Bet: $0.00</div>
    </div>
    </div>
    <div id="betNotification" class="bet-notification hidden"></div>
    
    <!-- Control Buttons -->
    <div class="control-buttons">
      <button id="startStopBtn" class="btn-small start-btn" disabled style="opacity: 0.5" title="Start/Stop automated betting">â–¶ï¸ Start</button>
      <!-- <button id="resetBetBtn" class="btn-small reset-btn">ğŸ”„ Reset</button> -->
      <button id="screenshotBtn" class="btn-small reset-btn" title="Export session data as CSV file">ğŸ’¾ Export</button>
      <button id="downloadLogsBtn" class="btn-small logs-btn" title="Download console logs as text file">ğŸ“¥ Logs</button>
    </div>

    <!-- Session Info Combined -->
    <div class="session-combined">
      <div class="session-left">
        <span class="timer-label">â±ï¸ Session:</span>
        <span id="sessionTimer" class="timer-value">00:00:00</span>
      </div>
      <div class="session-right" id="walletBalance">Balance: $0.00</div>
    </div>
      
      <!-- Super Summary -->
      <div class="super-summary">
        <h4>ğŸ“ˆ Full Session Summary</h4>
        <div class="super-stats">
          <span class="super-label">Total Profit: <span id="superProfitCurrency">$</span><span id="superProfit">0.00</span></span>
          <span class="super-label">Total Loss: <span id="superLossCurrency">$</span><span id="superLoss">0.00</span></span>
          <span class="super-label">Max Loss: <span id="maxLossCurrency">$</span><span id="maxLoss">0.00</span></span>
          <span class="super-label">Net: <span id="superNetCurrency">$</span><span id="superNet">0.00</span></span>
          <div class="super-stats-row">
            <span class="super-label">Bets: <span id="superBets">0</span></span>
            <span class="super-label">Resets: <span id="subResets" class="clickable-count" title="Click to view reset details">0</span></span>
            <span class="super-label">Refreshes: <span id="totalRefreshes" class="clickable-count" title="Click to view refresh details">0</span></span>
          </div>
        </div>
      </div>

    <!-- Tab Navigation -->
    <div class="tab-container">
      <button class="tab-btn active" id="settingsTab">âš™ï¸ Settings</button>
      <button class="tab-btn" id="historyTab">ğŸ“Š History</button>
      <button class="tab-btn" id="helpTab">â“ Help</button>
    </div>

    <!-- Settings Tab Content -->
    <div id="settingsContent" class="tab-content active">
      <!-- Configuration Manager -->
      <div class="config-manager">
        <select id="configSelect" class="config-select">
          <option value="">Select configuration...</option>
        </select>
        <div class="config-actions">
          <button id="saveConfigBtn" class="icon-btn" title="Save">ğŸ’¾</button>
          <button id="saveNewBtn" class="icon-btn" title="Save As New">â•</button>
          <button id="deleteConfigBtn" class="icon-btn" title="Delete">ğŸ—‘ï¸</button>
          <button id="exportBtn" class="icon-btn" title="Export">ğŸ“¤</button>
          <button id="importBtn" class="icon-btn" title="Import">ğŸ“¥</button>
        </div>
        <input type="file" id="importFileInput" accept=".json" style="display: none;">
      </div>

      
      <!-- Validation Error Message -->
      <div id="validationError" class="validation-error hidden"></div>
      <!-- Configuration -->
      <div class="config-section">
        <h4>ğŸ’° Basic Configuration</h4>
        <div class="form-row">
          <div class="form-half">
            <label>Bet Amount</label>
            <input type="number" id="betAmount" step="0.01" min="0.01" max="10000" placeholder="0.00" required />
          </div>
          <div class="form-half">
            <label>Cashout At</label>
            <input type="number" id="cashoutAt" step="0.01" min="1.01" max="1000" placeholder="0.00" required />
          </div>
        </div>
        <div class="form-row">
          <div class="form-half">
            <label>On Loss (%)</label>
            <input type="number" id="onLoss" step="0.01" min="-100" max="500" placeholder="35.00" required />
          </div>
          <div class="form-half">
            <label>On Win (%)</label>
            <input type="number" id="onWin" step="0.01" min="-100" max="500" placeholder="-25.00" required />
          </div>
        </div>
        
        <h4>ğŸ›‘ Stop Betting Rules</h4>
        <div class="form-row">
          <div class="form-half">
            <label>Crash At</label>
            <input type="number" id="crashAt" step="0.01" min="-10000" max="10000" placeholder="2.90" required />
          </div>
          <div class="form-half">
            <label>Times</label>
            <input type="number" id="crashTimes" step="1" min="0" max="100" placeholder="5" required />
          </div>
        </div>
        
        <h4>ğŸ”„ Resume Betting Rules</h4>
        <div class="form-row">
          <div class="form-half">
            <label>Resume At</label>
            <input type="number" id="resumeAt" step="0.01" min="0" max="100" placeholder="2.00" required />
          </div>
          <div class="form-half">
            <label>Adjust Bet (%)</label>
            <input type="number" id="resumeAdjust" step="0.01" min="-100" max="500" placeholder="0.00" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-half">
            <label>Resume Below At</label>
            <input type="number" id="resumeBelowAt" step="0.01" min="-100" max="100" placeholder="0.00" />
          </div>
          <div class="form-half">
            <label>Below Times</label>
            <input type="number" id="resumeBelowTimes" step="1" min="0" max="100" placeholder="0" />
          </div>
        </div>
        
        <h4>ğŸ”„ Reset Rules</h4>
        <div class="form-row">
          <div class="form-half">
            <label>If Changes (%)</label>
            <input type="number" id="resetThreshold" step="0.01" min="-100" max="1000" placeholder="0.00" />
          </div>
          <div class="form-half">
            <label>If Profit (x times)</label>
            <input type="number" id="profitTimes" step="1" min="0" max="100" placeholder="0" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-full">
            <label>If Loss Amount</label>
            <input type="number" id="lossResetAmount" step="0.01" min="0" max="10000" placeholder="0.00" />
          </div>
        </div>
        
        <h4>ğŸ›¡ï¸ Wallet Protection</h4>
        <div class="form-row">
          <div class="form-full">
            <label>Stop if Wallet Down (%)</label>
            <input type="number" id="walletStopLoss" step="0.01" min="0" max="100" placeholder="0" />
          </div>
        </div>
        
        <h4>ğŸ”¢ Display Settings</h4>
        <div class="form-row">
          <div class="form-full">
            <label>Decimal Places (0-5)</label>
            <input type="number" id="decimalPlaces" step="1" min="0" max="5" placeholder="0" value="0" />
          </div>
        </div>
      </div>
    </div>

    <!-- History Tab Content -->
    <div id="historyContent" class="tab-content">
           
      <!-- Current Cycle Profit Summary -->
      <div class="profit-summary">
        <h4>ğŸ“Š Current Cycle</h4>
        <div class="cycle-info">
          <div class="cycle-stat">
            <span class="cycle-label">Time:</span>
            <span id="cycleTimer" class="cycle-value">00:00:00</span>
          </div>
          <div class="cycle-stat">
            <span class="cycle-label">Bets:</span>
            <span id="cycleBets" class="cycle-value">0</span>
          </div>
        </div>
        <div class="profit-stats">
          <span class="profit-label">Profit: <span id="totalProfitCurrency">$</span><span id="totalProfit">0.00</span></span>
          <span class="loss-label">Loss: <span id="totalLossCurrency">$</span><span id="totalLoss">0.00</span></span>
          <span class="net-label">Net: <span id="netProfitCurrency">$</span><span id="netProfit">0.00</span></span>
        </div>
        <div class="graph-container">
          <canvas id="profitChart" width="200" height="100"></canvas>
        </div>
      </div>

      <!-- Betting History -->
      <div class="history-section">
        <div class="history-header">
          <h4>ğŸ“Š Recent Bets</h4>
          <button id="fullscreenBtn" class="fullscreen-btn">â›¶</button>
        </div>
        <div id="historyList" class="history-list">
          <!-- History items will be added here -->
        </div>
      </div>
    </div>

    <!-- Help Tab Content -->
    <div id="helpContent" class="tab-content">
      <div class="help-section">
        <div class="panel-header" data-panel="usage">
          <h4>ğŸ“š How to Use</h4>
          <span class="toggle-icon" id="usageToggle">â–¼</span>
        </div>
        <div class="panel-content" id="usageContent">
          <div class="help-text">
            <p><strong>1. Configure Settings:</strong> Set your betting parameters in the Settings tab</p>
            <p><strong>2. Save Config:</strong> Click "Save Config" to store your settings</p>
            <p><strong>3. Start Betting:</strong> Click "Start" when status shows connected (green dot)</p>
            <p><strong>4. Monitor:</strong> Watch real-time activity in the History tab</p>
          </div>
        </div>
      </div>

      <div class="help-section">
        <div class="panel-header" data-panel="config">
          <h4>âš™ï¸ Configuration Guide</h4>
          <span class="toggle-icon" id="configToggle">â–¼</span>
        </div>
        <div class="panel-content" id="configContent">
          <div class="help-text">
            <p><strong>Bet Amount:</strong> Initial betting amount</p>
            <p><strong>Cashout At:</strong> Target multiplier to cash out (e.g., 2.5x)</p>
            <p><strong>On Loss (%):</strong> Applied directly after loss</p>
            <p><strong>â€¢ +30:</strong> Increase next bet by 30% | <strong>â€¢ -30:</strong> Decrease next bet by 30%</p>
            <p><strong>On Win (%):</strong> Applied directly after win</p>
            <p><strong>â€¢ -25:</strong> Decrease next bet by 25% | <strong>â€¢ +25:</strong> Increase next bet by 25%</p>
          </div>
        </div>
      </div>

      <div class="help-section">
        <div class="panel-header" data-panel="stop">
          <h4>ğŸ›‘ Stop Betting Rules</h4>
          <span class="toggle-icon collapsed" id="stopToggle">â–¼</span>
        </div>
        <div class="panel-content collapsed" id="stopContent">
          <div class="help-text">
            <p><strong>Crash At:</strong> Skip rule threshold (0 = disabled)</p>
            <p><strong>â€¢ Positive value:</strong> Count crashes below threshold (e.g., +2.9 means crash &lt; 2.9)</p>
            <p><strong>â€¢ Negative value:</strong> Count crashes above |threshold| (e.g., -2.9 means crash &gt; 2.9)</p>
            <p><strong>Times:</strong> Number of consecutive crashes meeting the selected condition</p>
            <p><em>Example: -2.9 with Times 5 = skip after 5 consecutive crashes above 2.9x</em></p>
          </div>
        </div>
      </div>

      <div class="help-section">
        <div class="panel-header" data-panel="resume">
          <h4>ğŸ”„ Resume & Reset Rules</h4>
          <span class="toggle-icon collapsed" id="resumeToggle">â–¼</span>
        </div>
        <div class="panel-content collapsed" id="resumeContent">
          <div class="help-text">
            <p><strong>Resume At:</strong> Resume betting when crash â‰¥ this value (e.g., 5.0x, 0 = disabled)</p>
            <p><strong>Adjust Bet (%):</strong> Modify bet amount when resuming (0 = no change)</p>
            <p><strong>Resume Below At:</strong> Alternative resume condition (0 = disabled)</p>
            <p><strong>â€¢ Positive value:</strong> Resume when crashes < value (e.g., 1.5)</p>
            <p><strong>â€¢ Negative value:</strong> Resume when crashes > |value| (e.g., -3.0)</p>
            <p><strong>Below Times:</strong> Number of consecutive crashes meeting condition</p>
            <p><em>Examples: +1.5 = resume after 3 crashes < 1.5x, -3.0 = resume after 3 crashes > 3.0x</em></p>
            <p><strong>Reset Threshold:</strong> Reset to original bet if change exceeds % (0 = disabled)</p>
            <p><strong>Profit Reset:</strong> Reset bet after profit reaches X times original (0 = disabled)</p>
            <p><strong>Loss Reset:</strong> Reset sub-session when loss reaches amount (0 = disabled)</p>
            <p><em>Sub-session resets: Click reset count in summary to view detailed history</em></p>
          </div>
        </div>
      </div>

      <div class="help-section">
        <div class="panel-header" data-panel="safety">
          <h4>ğŸ›¡ï¸ Safety Features</h4>
          <span class="toggle-icon collapsed" id="safetyToggle">â–¼</span>
        </div>
        <div class="panel-content collapsed" id="safetyContent">
          <div class="help-text">
            <p><strong>Wallet Protection:</strong> Stop if wallet drops by % (0 = disabled)</p>
            <p><strong>Auto-refresh:</strong> Page refreshes on connection loss</p>
            <p><strong>Decimal Places:</strong> Number format precision (0-5)</p>
          </div>
        </div>
      </div>

      <div class="help-section">
        <div class="panel-header" data-panel="notes">
          <h4>âš ï¸ Important Notes</h4>
          <span class="toggle-icon collapsed" id="notesToggle">â–¼</span>
        </div>
        <div class="panel-content collapsed" id="notesContent">
          <div class="help-text">
            <p><strong>â€¢</strong> Works on supported crash game domains/pages</p>
            <p><strong>â€¢</strong> Green dot = Connected, Red dot = Disconnected</p>
            <p><strong>â€¢</strong> Set values to 0 to disable specific rules</p>
            <p><strong>â€¢</strong> Always test with small amounts first</p>
            <p><strong>â€¢</strong> Gambling involves risk - bet responsibly</p>
          </div>
        </div>
      </div>
    </div>

    <div class="bottom-spacer"></div>

    <!-- Loss Details Dialog -->
    <div id="lossDetailsDialog" class="dialog-overlay">
      <div class="dialog-content">
        <div class="dialog-header">
          <h3>Loss Reset Details</h3>
          <button id="closeLossDialog" class="close-btn">&times;</button>
        </div>
        <div id="lossDetailsList" class="dialog-body"></div>
      </div>
    </div>

    <!-- Refresh Details Dialog -->
    <div id="refreshDetailsDialog" class="dialog-overlay">
      <div class="dialog-content">
        <div class="dialog-header">
          <h3>Page Refresh Details</h3>
          <button id="closeRefreshDialog" class="close-btn">&times;</button>
        </div>
        <div id="refreshDetailsList" class="dialog-body"></div>
      </div>
    </div>

    <script src="sidepanel.js"></script>
  </body>
</html>
