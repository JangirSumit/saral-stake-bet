window.html2canvas = function(element, options) {
  return new Promise(function(resolve, reject) {
    try {
      var canvas = document.createElement('canvas');
      var ctx = canvas.getContext('2d');
      var rect = element.getBoundingClientRect();
      
      canvas.width = rect.width * (options.scale || 1);
      canvas.height = rect.height * (options.scale || 1);
      
      // Fill background
      ctx.fillStyle = options.backgroundColor || '#0f172a';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Capture element content using DOM-to-canvas conversion
      var walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT);
      var node;
      var y = 20;
      
      ctx.fillStyle = '#ffffff';
      ctx.font = '12px Arial';
      
      while (node = walker.nextNode()) {
        var text = node.textContent.trim();
        if (text) {
          ctx.fillText(text, 10, y);
          y += 15;
        }
      }
      
      resolve(canvas);
    } catch (error) {
      reject(error);
    }
  });
};